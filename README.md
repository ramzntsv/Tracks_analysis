В рамкахданной работы реализован групповой проект по сбору и анализу музыкальных треков.
**Состав команды:**
* Мезенцев Роман
* Панченков Никита
* Садков Глеб
* Брюхов Сергей
* Рахвальский Леонид

**Первый этап:** 
* Выбор темы - анализ треков лучших исполнителей в жанре hip-hop
* Выбранные источники: Spotify, Genius, Rapidapi.
* Определение бизнес цели - выявление и предсказываение степени популярности трека от его признаков в определенном жанре

**Второй этап: Настройка репозитория и логирования**
* Создание отдельной ветки для работы каждого из участников
* Настройка правил для слияния веток 
* Создание файлов ```.gitignore``` для личного рабочего файла каждого из участников
* Настройка локального логирования в ветках участников команды для отслеживания ошибок во время парсинга, добавления файла ```my.log``` в ```.gitignore```
* Создание файла ```py_log.log``` для логирования в основном рабочем файле

**Третий этап: Сбор данных**
* **Первый этап: Сбор данных посредством API:**
    * Получение API ключа Spotify: регистрация приложения, получение client_secret, client_id, refresh_token.
    * Написание функции для получения access_token с помощь полученных раннее параметров.
    * API запросы для получения топ 200 артистов в жанре хип-хоп с помощью метода ```search_artist``` spotify api
    * API запросы для получения всех песен этих артистов с помощью метода ```search_track``` spotify api
    * API запросы для получения данных по мелодиям трекво с помощью ```rapid_api``` 
    * Формирование датасетов ```artists_dataset.csv, tracks_dataset.csv, melodies.csv```

* **Второй этап: Сбор данных просредством скраппинга сайта Genius**
    * Использование библиотеки селениум для создание виртуального драйвера для обхода блокировки ботов и интерактивного взамодействия с сайтом
    * Получение полных названий треков и имен исполнителей из датасетов ```artists_dataset, tracks_dataset``` для поиска текстов песен
    * Получение датасета ```tracks_texts``` и объединение его с ```tracks_dataset```

**Четвертый этап: Обработка данных**
* **Первый этап: очистка датасетов от пустых и повторяющихся значений**
    * Важно сказать, что метод search Spotify API не гарантирует уникальность результатов, так как просто ищет значения, совпавшие с keyword строкой
    * Обработка повторяющихся значений в датасете ```artists_dataset```, получившиеся из-за специфики работы метода search, при котором одни и теже объекты могут быть на разных страницах, из-за чего они были взяты дважды (незаполненных ячеек в датасете не было)
    * Обработка повторяющихся значений в датасете ```tracks_dataset```, появившихся аналогично с ```artist_datadet```, также повторяюищеся данные появились из-за совместных треков, которые добавлялись несколько раз, (пропущенных значений также не оказалось)
    * Обработка треков с одинаковым названием и исполнителями, но с разным id, такие треки появляются, если один и тот же трек был сначала выпущен как сингл, а потом добавлен в альбом, треки по сути одинаковые, но имеют разный ID
    * Обработка пустых значений в ```tracks_texts```, появившихся из-за ошибок, возникших во время парсинга, как было видно из логов, было 2 основных типа ошибок: read_timeout (слишком долгий овтет сервера) и ошибка связанная с тем, что трек не удалось найти, из-за чего текст не был добавлен, также была ошибка связанная с наличием эмодзи в названии трека
    * Обработка пустых значений в ```melodies```, появившихся из-за ошибка соединения и нестабильной работы rapid_api

* **Второй этап: преборазование текста в признаки**:
    * Получение с помощью регулярных выражений различных признаков, связанных с текстом песни и формирование датасета ```lyrics_stats```, содержащего:
        * track_id - уникальный id трека
        * Amount_words - количество слов в песне
        * Amount_unique_words - количество уникальных слов в песне
        * Diversity_coeff - коэффициент уникальности расчитанный как ```Amount_words/Amount_unique_words``` 
        * Amount_adlibs - количество эдлибов (подпевок) в песне
        * Amount_verses - количество куплетов
        * Amount_chorus - количетсво припевов
        * Avg_words_verse - среднее количество слов в куплете
        * Все полченные признаки числовые

* **Третий этап: Описание остальных признаков**
    * ```artists_dataset```:
        * id - уникальных идентификатор артиста
        * name - имя артиста
        * popularity - популярность артиста
        * followers - количество подписавшихся на артиста людей
        * Все признаки числовые 
    * ```tracks_dataset```:
        * id - уникальный id трека
        * name - название песни
        * artists - (мультикатегориальный) строка артистов, учавствующих в треке
        * available_markets - (мультикатегориальный) список стран, в которых доступна песня
        * duration_ms - (числовой) длительность трека в мс
        * explicit - (бинарный) есть/нет 18+ контента/ ненормативной лексики
        * track_number - (числовой) номер трека в альбоме
        * release_date - (datetime) дата релиза альбома/сингла, в котором выпущена песня
        * album_type - (категориальный) тип альбома (album/api/compilation)
        * popularity - (числовой) популярность песни (целевая переменная)
    * ```melodies```
        * id
        * mode (бинарный) - мажор/минор
        * camelot - (категориальный) - тональность трека в нотации camelot
        * tempo - (числовой) - скорость трека (bpm)
        * energy - (числовой [0, 100]) - интенсивность и активность звучания трека
        * danceability - (числовой [0, 100]) - "танцевальность" трека
        * happiness - (числовой [0, 100]) - "позитивность" трека
        * acousticness - (числовой [0, 100]) - вероятность того, что трек был создан с использованием акустических инструментов
        * instrumentalness - (числовой [0, 100]) - сколько трек содержит вокала
        * speechiness - (числовой [0, 100]) - насколько трек похож на устную речь
        * loudness - (числовой) громкость песни в децибелах

* **Четвертый этап: объединение датасетов и добавление/преобразование/исключение признаков**
    * Добавили:
        * number_of_artists - количество артистов в трека
        * popularity_artist_mean - средняя популярность артистов
        * followers_mean - среднее количество пописчиков у артистов
        * num_of_markets - количество стран, в которых доступна песня
    * Удалили: 
        * camelot - сложно интерпретируемый признак
        * artists - заменили на другие признаки
        * available_markets - заменили на num_of_markets 
    * Преобразовали:
        * mode - one-hot encoding, столбцы major/minor
        * album_type  - one-hot encoding, столбцы album/single/compilation
        * release_date - преобразовали в числовой с помощью to_datetime
        * duration_ms - в duration_min

* **Пятый этап: проверка попарных корреляций признаков/ зависимости целевой переменной от одномерных признаков**
    * Постройка графиков распределения и зависимостей/корреляций
        * распределение по странам
        * попарные корелляции артистов 
        * попарные корелляции текстовых признаков
        * распределения различных признаков 
    * После проверки корреляций были удалены стоблцы:
        * followers_mean - очевидно связано с popularity_artist_mean
        * energy - связано с danceability и happiness
        * instrumentalness - связан со speechiness
        * major/minor - нет связи с целевой переменной, почти одинаковая популярность как мажорных так и минорных песен
        * number_of_artists - нет связи с целевой переменной, почти все треки есть на всех рынках
        * Amount_words, Amount_unique_words - уже есть Diversity_coeff и Avg_words_verse, признак ине актуальны, есть корреляции с остальными признаками
        * explicit - нет связи с целевой переменной, равномерно распределен
        * track_number - нет связи с целевой переменной, актуален только для альбомов
        * Amount_verses - есть Avg_words_verse и корреляция с Amount_chorus

* **Шестой этап: анализ многомерных факторов**
    * Построение многомерных графиков и выявление по ним зависимостей
    * Выявление нетривиальных зависимостей
    * Определение метрик, оказывающих в совокупности влияние на целевую переменную

* **Седьмой этап:  обучение модели машенного обучения**
    * Определение цели модели - предсказывание популярности трека по факторам
    * Нормализация всех признаков и целевой переменной
    * Определение обучающей и тестовой выборки
    * Обучение модели
    * Проверка результатов
    * Получение метрик методом наименьших квадратов и средней абсолютной погрешности

* **Восьмой этап: интерпретация результатов**
    * Среднее отклонение обученной модели от реальных данных - ```14 %```, что не подходит для точного предсказывания популярности трека, но подойдет для того, чтобы обозначить класс популярности песни по параметрам (low/medium/high)
    * Полученный результат довольно реалистичный при работе с музыкальными данными, так как признаки косвенные, и не оказывают сильное влияние на результат
    